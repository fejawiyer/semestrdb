2024-12-13 01:12:22,366 INFO Try to login
2024-12-13 01:12:22,367 INFO Login:system
2024-12-13 01:12:22,401 INFO Login ok
2024-12-13 01:12:34,407 INFO SQL Query: select * from s_emp
2024-12-13 01:12:34,620 INFO Success query
2024-12-13 01:12:39,601 INFO Try to drop table Supplier cascade constraints
2024-12-13 01:12:39,611 INFO Success
2024-12-13 01:12:39,611 INFO Try to drop table Supplies cascade constraints
2024-12-13 01:12:39,622 INFO Success
2024-12-13 01:12:39,622 INFO Try to drop table Product cascade constraints
2024-12-13 01:12:39,631 INFO Success
2024-12-13 01:12:39,631 INFO Try to drop table LogsProduct
2024-12-13 01:12:39,638 INFO Success
2024-12-13 01:12:39,638 INFO Try to drop table LogsSupplier
2024-12-13 01:12:39,641 INFO Success
2024-12-13 01:12:39,641 INFO Try to drop table LogsSupplies
2024-12-13 01:12:39,644 INFO Success
2024-12-13 01:12:39,645 INFO Try to create table Supplier
(
   ID                   NUMBER(3)            not null,
   Supplier_name        VARCHAR2(20),
   constraint PK_SUPPLIER primary key (ID)
)
2024-12-13 01:12:39,648 INFO Success
2024-12-13 01:12:39,648 INFO Try to create table Supplies
(
   ID                   NUMBER(3)            not null,
   Product_id           NUMBER(3),
   Quantity             NUMBER(5),
   Total                NUMBER(10),
   Delivery_date        DATE,
   Supplier_ID          NUMBER(3),
   constraint PK_SUPPLIES primary key (ID)
)
2024-12-13 01:12:39,651 INFO Success
2024-12-13 01:12:39,651 INFO Try to create table Product
(
   ID                   NUMBER(3)            not null,
   pName                 VARCHAR2(127),
   pType                 VARCHAR2(127),
   Price                NUMBER(5),
   Quantity             NUMBER(5),
   Quantity_min         NUMBER(5),
   constraint PK_PRODUCT primary key (ID)
)
2024-12-13 01:12:39,655 INFO Success
2024-12-13 01:12:39,655 INFO Try to create table LogsSupplier
(
   ID                   NUMBER(3)            not null,
   ptime                DATE,
   ptype                VARCHAR2(500),
   before               VARCHAR2(500),
   after                VARCHAR2(500)
)
2024-12-13 01:12:39,657 INFO Success
2024-12-13 01:12:39,657 INFO Try to create table LogsSupplies
(
   ID                   NUMBER(3)            not null,
   ptime                DATE,
   ptype                VARCHAR2(500),
   before               VARCHAR2(500),
   after                VARCHAR2(500)
)
2024-12-13 01:12:39,658 INFO Success
2024-12-13 01:12:39,658 INFO Try to create table LogsProduct
(
   ID                   NUMBER(3)            not null,
   ptime                DATE,
   ptype                VARCHAR2(500),
   before               VARCHAR2(500),
   after                VARCHAR2(500)
)
2024-12-13 01:12:39,660 INFO Success
2024-12-13 01:12:39,660 INFO Try to alter table Supplies
   add constraint FK_SUPPLIES_REFERENCE_SUPPLIER foreign key (Supplier_ID)
      references Supplier (ID)
2024-12-13 01:12:39,663 INFO Success
2024-12-13 01:12:39,663 INFO Try to alter table Supplies
   add constraint FK_SUPPLIES_REFERENCE_PRODUCT foreign key (Product_id)
      references Product (ID)
2024-12-13 01:12:39,665 INFO Success
2024-12-13 01:12:39,665 INFO Try to create or replace procedure insert_supplier(
   p_id            IN NUMBER,
   p_supplier_name IN VARCHAR2
)
is
begin
   insert into Supplier (ID, Supplier_name)
   values (p_id, p_supplier_name);
   commit;
end;
2024-12-13 01:12:39,670 INFO Success
2024-12-13 01:12:39,670 INFO Try to create or replace procedure insert_product(
   p_id            IN NUMBER,
   p_name          IN VARCHAR2,
   p_type          IN VARCHAR2,
   p_price         IN NUMBER,
   p_quantity      IN NUMBER,
   p_quantity_min  IN NUMBER
)
is
begin
   insert into Product (ID, pName, pType, Price, Quantity, Quantity_min)
   values (p_id, p_name, p_type, p_price, p_quantity, p_quantity_min);
   commit;
end;
2024-12-13 01:12:39,675 INFO Success
2024-12-13 01:12:39,675 INFO Try to create or replace procedure insert_supplies(
   p_id            IN NUMBER,
   p_product_id    IN NUMBER,
   p_quantity      IN NUMBER,
   p_total         IN NUMBER,
   p_delivery_date IN DATE,
   p_supplier_id   IN NUMBER
)
is
begin
   insert into Supplies (ID, Product_id, Quantity, Total, Delivery_date, Supplier_ID)
   values (p_id, p_product_id, p_quantity, p_total, p_delivery_date, p_supplier_id);
   commit;
end;
2024-12-13 01:12:39,680 INFO Success
2024-12-13 01:12:39,680 INFO Try to create or replace procedure update_supplier(
   p_id            IN NUMBER,
   p_supplier_name IN VARCHAR2
)
is
begin
   update Supplier
   set Supplier_name = p_supplier_name
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,685 INFO Success
2024-12-13 01:12:39,685 INFO Try to create or replace procedure update_product(
   p_id            IN NUMBER,
   p_name          IN VARCHAR2,
   p_type          IN VARCHAR2,
   p_price         IN NUMBER,
   p_quantity      IN NUMBER,
   p_quantity_min  IN NUMBER
)
is
begin
   update Product
   set pName = p_name,
       pType = p_type,
       Price = p_price,
       Quantity = p_quantity,
       Quantity_min = p_quantity_min
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,689 INFO Success
2024-12-13 01:12:39,689 INFO Try to create or replace procedure update_supplies(
   p_id            IN NUMBER,
   p_product_id    IN NUMBER,
   p_quantity      IN NUMBER,
   p_total         IN NUMBER,
   p_delivery_date IN DATE,
   p_supplier_id   IN NUMBER
)
is
begin
   update Supplies
   set Product_id = p_product_id,
       Quantity = p_quantity,
       Total = p_total,
       Delivery_date = p_delivery_date,
       Supplier_ID = p_supplier_id
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,694 INFO Success
2024-12-13 01:12:39,694 INFO Try to create or replace procedure delete_from_supplier(
   p_id IN NUMBER
)
is
begin
   delete from Supplier
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,698 INFO Success
2024-12-13 01:12:39,698 INFO Try to create or replace procedure delete_from_product(
   p_id IN NUMBER
)
is
begin
   delete from Product
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,701 INFO Success
2024-12-13 01:12:39,701 INFO Try to create or replace procedure delete_from_supplies(
   p_id IN NUMBER
)
is
begin
   delete from Supplies
   where ID = p_id;
   commit;
end;
2024-12-13 01:12:39,705 INFO Success
2024-12-13 01:12:39,705 INFO Try to CREATE TRIGGER LoggerSupplier
  AFTER INSERT OR UPDATE OR DELETE ON supplier FOR EACH ROW
DECLARE
  data_before VARCHAR2(500);
  data_after VARCHAR2(500);
  max_id NUMBER(20);
BEGIN
    select max(id) into max_id from LogsSupplier;

    IF MAX_ID is NULL THEN
      max_id := 0;
    END IF;
  IF INSERTING THEN
    data_before := NULL;
    data_after := 'ID:' || :new.id || ' supplier_name:' || :new.supplier_name;

    INSERT INTO LogsSupplier(id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'INSERT', data_before, data_after);

  ELSIF UPDATING THEN

    data_before := 'ID:' || :old.id || ' supplier_name:' || :old.supplier_name;
    data_after := 'ID:' || :new.id || ' supplier_name:' || :new.supplier_name;

    INSERT INTO LogsSupplier(id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'UPDATE', data_before, data_after);

  ELSIF DELETING THEN

    data_before := 'ID:' || :old.id || ' supplier_name:' || :old.supplier_name;
    data_after := NULL;

    INSERT INTO LogsSupplier(id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'DELETE', data_before, data_after);

  END IF;

END;
2024-12-13 01:12:39,709 INFO Success
2024-12-13 01:12:39,709 INFO Try to CREATE TRIGGER LoggerSupplies
  AFTER INSERT OR UPDATE OR DELETE ON Supplies
  FOR EACH ROW
DECLARE
  data_before VARCHAR2(500);
  data_after VARCHAR2(500);
  max_id NUMBER(20);
BEGIN
  SELECT max(id) INTO max_id FROM LogsSupplies;

  IF max_id IS NULL THEN
    max_id := 0;
  END IF;

  IF INSERTING THEN
    data_before := NULL;
    data_after := 'ID:' || :new.id || ' Product_id:' || :new.product_id ||
                  ' Quantity:' || :new.quantity || ' Total:' || :new.total ||
                  ' Delivery_date:' || :new.delivery_date || ' Supplier_ID:' || :new.supplier_id;

    INSERT INTO LogsSupplies (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'INSERT', data_before, data_after);

  ELSIF UPDATING THEN
    data_before := 'ID:' || :old.id || ' Product_id:' || :old.product_id ||
                   ' Quantity:' || :old.quantity || ' Total:' || :old.total ||
                   ' Delivery_date:' || :old.delivery_date || ' Supplier_ID:' || :old.supplier_id;
    data_after := 'ID:' || :new.id || ' Product_id:' || :new.product_id ||
                  ' Quantity:' || :new.quantity || ' Total:' || :new.total ||
                  ' Delivery_date:' || :new.delivery_date || ' Supplier_ID:' || :new.supplier_id;

    INSERT INTO LogsSupplies (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'UPDATE', data_before, data_after);

  ELSIF DELETING THEN
    data_before := 'ID:' || :old.id || ' Product_id:' || :old.product_id ||
                   ' Quantity:' || :old.quantity || ' Total:' || :old.total ||
                   ' Delivery_date:' || :old.delivery_date || ' Supplier_ID:' || :old.supplier_id;
    data_after := NULL;

    INSERT INTO LogsSupplies (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'DELETE', data_before, data_after);
  END IF;

END;
2024-12-13 01:12:39,714 INFO Success
2024-12-13 01:12:39,714 INFO Try to CREATE TRIGGER LoggerProduct
  AFTER INSERT OR UPDATE OR DELETE ON Product
  FOR EACH ROW
DECLARE
  data_before VARCHAR2(500);
  data_after VARCHAR2(500);
  max_id NUMBER(20);
BEGIN
  SELECT max(id) INTO max_id FROM LogsProduct;

  IF max_id IS NULL THEN
    max_id := 0;
  END IF;

  IF INSERTING THEN
    data_before := NULL;
    data_after := 'ID:' || :new.id || ' pName:' || :new.pName || ' pType:' || :new.pType ||
                  ' Price:' || :new.Price || ' Quantity:' || :new.Quantity || ' Quantity_min:' || :new.Quantity_min;

    INSERT INTO LogsProduct (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'INSERT', data_before, data_after);

  ELSIF UPDATING THEN
    data_before := 'ID:' || :old.id || ' pName:' || :old.pName || ' pType:' || :old.pType ||
                   ' Price:' || :old.Price || ' Quantity:' || :old.Quantity || ' Quantity_min:' || :old.Quantity_min;
    data_after := 'ID:' || :new.id || ' pName:' || :new.pName || ' pType:' || :new.pType ||
                  ' Price:' || :new.Price || ' Quantity:' || :new.Quantity || ' Quantity_min:' || :new.Quantity_min;

    INSERT INTO LogsProduct (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'UPDATE', data_before, data_after);

  ELSIF DELETING THEN
    data_before := 'ID:' || :old.id || ' pName:' || :old.pName || ' pType:' || :old.pType ||
                   ' Price:' || :old.Price || ' Quantity:' || :old.Quantity || ' Quantity_min:' || :old.Quantity_min;
    data_after := NULL;

    INSERT INTO LogsProduct (id, ptime, pType, before, after)
    VALUES (max_id+1, SYSTIMESTAMP, 'DELETE', data_before, data_after);
  END IF;

END;
2024-12-13 01:12:39,719 INFO Success
2024-12-13 01:12:39,719 INFO Try to CREATE OR REPLACE PROCEDURE get_supplier_logs (
    p_start_time IN DATE DEFAULT NULL,
    p_end_time   IN DATE DEFAULT NULL,
    p_type       IN VARCHAR2 DEFAULT NULL
)
IS
BEGIN
    FOR rec IN (
        SELECT ID, ptime, pType, before, after
        FROM LogsSupplier
        WHERE (p_start_time IS NULL OR ptime >= p_start_time)
          AND (p_end_time IS NULL OR ptime <= p_end_time)
          AND (p_type IS NULL OR pType = p_type)
        ORDER BY ptime DESC
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('ID: ' || rec.ID || ' | Time: ' || rec.ptime || ' | Type: ' || rec.pType ||
                             ' | Before: ' || rec.before || ' | After: ' || rec.after);
    END LOOP;
END;
2024-12-13 01:12:39,725 INFO Success
2024-12-13 01:12:39,725 INFO Try to CREATE OR REPLACE PROCEDURE get_supplies_logs (
    p_start_time IN DATE DEFAULT NULL,
    p_end_time   IN DATE DEFAULT NULL,
    p_type       IN VARCHAR2 DEFAULT NULL
)
IS
BEGIN
    FOR rec IN (
        SELECT ID, ptime, pType, before, after
        FROM LogsSupplies
        WHERE (p_start_time IS NULL OR ptime >= p_start_time)
          AND (p_end_time IS NULL OR ptime <= p_end_time)
          AND (p_type IS NULL OR pType = p_type)
        ORDER BY ptime DESC
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('ID: ' || rec.ID || ' | Time: ' || rec.ptime || ' | Type: ' || rec.pType ||
                             ' | Before: ' || rec.before || ' | After: ' || rec.after);
    END LOOP;
END;
2024-12-13 01:12:39,730 INFO Success
2024-12-13 01:12:39,730 INFO Try to CREATE OR REPLACE PROCEDURE get_product_logs (
    p_start_time IN DATE DEFAULT NULL,
    p_end_time   IN DATE DEFAULT NULL,
    p_type       IN VARCHAR2 DEFAULT NULL
)
IS
BEGIN
    FOR rec IN (
        SELECT ID, ptime, pType, before, after
        FROM LogsProduct
        WHERE (p_start_time IS NULL OR ptime >= p_start_time)
          AND (p_end_time IS NULL OR ptime <= p_end_time)
          AND (p_type IS NULL OR pType = p_type)
        ORDER BY ptime DESC
    ) LOOP
        DBMS_OUTPUT.PUT_LINE('ID: ' || rec.ID || ' | Time: ' || rec.ptime || ' | Type: ' || rec.pType ||
                             ' | Before: ' || rec.before || ' | After: ' || rec.after);
    END LOOP;
END;
2024-12-13 01:12:39,735 INFO Success
2024-12-13 01:12:39,735 INFO Try to CREATE OR REPLACE PROCEDURE generate_summary_report (
    p_flag1 IN BOOLEAN DEFAULT FALSE,   -- флаг сортировки по названию сущности
    p_flag2 IN BOOLEAN DEFAULT FALSE,   -- флаг сортировки по типу операции
    p_flag3 IN BOOLEAN DEFAULT FALSE    -- флаг сортировки по количеству операций
) IS
BEGIN
    -- Если флаг 1 (сортировка по названию сущности)
    IF p_flag1 THEN
        FOR rec IN (
            SELECT entity_name, operation_type, COUNT(*) AS operation_count
            FROM (
                SELECT 'Supplier' AS entity_name, pType AS operation_type FROM LogsSupplier
                UNION ALL
                SELECT 'Supplies' AS entity_name, pType AS operation_type FROM LogsSupplies
                UNION ALL
                SELECT 'Product' AS entity_name, pType AS operation_type FROM LogsProduct
            )
            GROUP BY entity_name, operation_type
            ORDER BY entity_name
        ) LOOP
            DBMS_OUTPUT.PUT_LINE('Entity: ' || rec.entity_name ||
                                 ' | Operation Type: ' || rec.operation_type ||
                                 ' | Count: ' || rec.operation_count);
        END LOOP;
    END IF;

    -- Если флаг 2 (сортировка по типу операции)
    IF p_flag2 THEN
        FOR rec IN (
            SELECT entity_name, operation_type, COUNT(*) AS operation_count
            FROM (
                SELECT 'Supplier' AS entity_name, pType AS operation_type FROM LogsSupplier
                UNION ALL
                SELECT 'Supplies' AS entity_name, pType AS operation_type FROM LogsSupplies
                UNION ALL
                SELECT 'Product' AS entity_name, pType AS operation_type FROM LogsProduct
            )
            GROUP BY entity_name, operation_type
            ORDER BY operation_type
        ) LOOP
            DBMS_OUTPUT.PUT_LINE('Entity: ' || rec.entity_name ||
                                 ' | Operation Type: ' || rec.operation_type ||
                                 ' | Count: ' || rec.operation_count);
        END LOOP;
    END IF;

    -- Если флаг 3 (сортировка по количеству операций)
    IF p_flag3 THEN
        FOR rec IN (
            SELECT entity_name, operation_type, COUNT(*) AS operation_count
            FROM (
                SELECT 'Supplier' AS entity_name, pType AS operation_type FROM LogsSupplier
                UNION ALL
                SELECT 'Supplies' AS entity_name, pType AS operation_type FROM LogsSupplies
                UNION ALL
                SELECT 'Product' AS entity_name, pType AS operation_type FROM LogsProduct
            )
            GROUP BY entity_name, operation_type
            ORDER BY operation_count DESC
        ) LOOP
            DBMS_OUTPUT.PUT_LINE('Entity: ' || rec.entity_name ||
                                 ' | Operation Type: ' || rec.operation_type ||
                                 ' | Count: ' || rec.operation_count);
        END LOOP;
    END IF;
END;
2024-12-13 01:12:39,743 INFO Success
2024-12-13 01:12:39,743 INFO Success query
2024-12-13 01:12:42,539 INFO Selected table: SUPPLIER
2024-12-13 01:12:42,539 INFO Try to load table struct
2024-12-13 01:12:42,539 INFO Describe SUPPLIER
2024-12-13 01:12:42,539 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:12:44,464 INFO Try to call insert_supplier(1, 'dawdawd')
2024-12-13 01:12:44,467 INFO Success query
2024-12-13 01:12:45,132 INFO Insert success
2024-12-13 01:14:03,340 INFO Selected table: SUPPLIER
2024-12-13 01:14:03,340 INFO Try to load table struct
2024-12-13 01:14:03,340 INFO Describe SUPPLIER
2024-12-13 01:14:03,340 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:14:04,729 INFO Try to call delete_from_supplier(1)
2024-12-13 01:14:04,732 INFO Success query
2024-12-13 01:14:05,382 INFO Delete success
2024-12-13 01:14:07,684 INFO Selected table: SUPPLIER
2024-12-13 01:14:07,684 INFO Try to load table struct
2024-12-13 01:14:07,684 INFO Describe SUPPLIER
2024-12-13 01:14:07,685 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:14:08,745 INFO Try to call delete_from_supplier(23)
2024-12-13 01:14:08,746 INFO Success query
2024-12-13 01:14:09,990 INFO Delete success
2024-12-13 01:14:12,716 INFO Selected table: SUPPLIER
2024-12-13 01:14:12,716 INFO Try to load table struct
2024-12-13 01:14:12,716 INFO Describe SUPPLIER
2024-12-13 01:14:12,717 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:14:14,595 INFO Try to call delete_from_supplier(222222)
2024-12-13 01:14:14,596 INFO Success query
2024-12-13 01:14:15,599 INFO Delete success
2024-12-13 01:14:58,257 INFO Selected table: SUPPLIER
2024-12-13 01:14:58,257 INFO Try to load table struct
2024-12-13 01:14:58,257 INFO Describe SUPPLIER
2024-12-13 01:14:58,258 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:15:00,120 INFO Try to call insert_supplier(3, 3333)
2024-12-13 01:15:00,121 INFO Success query
2024-12-13 01:15:00,748 INFO Insert success
2024-12-13 01:15:02,810 INFO Selected table: SUPPLIER
2024-12-13 01:15:02,811 INFO Try to load table struct
2024-12-13 01:15:02,811 INFO Describe SUPPLIER
2024-12-13 01:15:02,811 INFO Got columns:[('ID', 'NUMBER'), ('SUPPLIER_NAME', 'VARCHAR2')]
2024-12-13 01:15:03,712 INFO Try to call delete_from_supplier(3)
2024-12-13 01:15:03,714 INFO Success query
2024-12-13 01:15:04,492 INFO Delete success
2024-12-13 01:15:12,564 INFO Selected table: PRODUCT
2024-12-13 01:15:12,564 INFO Try to load table struct
2024-12-13 01:15:12,564 INFO Describe PRODUCT
2024-12-13 01:15:12,565 INFO Got columns:[('ID', 'NUMBER'), ('PNAME', 'VARCHAR2'), ('PTYPE', 'VARCHAR2'), ('PRICE', 'NUMBER'), ('QUANTITY', 'NUMBER'), ('QUANTITY_MIN', 'NUMBER')]
2024-12-13 01:15:17,249 INFO Try to call insert_product(1, 1, 1, 1, 1, 1)
2024-12-13 01:15:17,253 INFO Success query
2024-12-13 01:15:17,742 INFO Insert success
2024-12-13 01:15:20,411 INFO Selected table: PRODUCT
2024-12-13 01:15:20,411 INFO Try to load table struct
2024-12-13 01:15:20,411 INFO Describe PRODUCT
2024-12-13 01:15:20,412 INFO Got columns:[('ID', 'NUMBER'), ('PNAME', 'VARCHAR2'), ('PTYPE', 'VARCHAR2'), ('PRICE', 'NUMBER'), ('QUANTITY', 'NUMBER'), ('QUANTITY_MIN', 'NUMBER')]
2024-12-13 01:15:21,714 INFO Try to call delete_from_product(1)
2024-12-13 01:15:21,717 INFO Success query
2024-12-13 01:15:22,062 INFO Delete success
2024-12-13 01:16:43,803 INFO SQL Query: select * from s_emp
2024-12-13 01:16:43,910 INFO Success query
